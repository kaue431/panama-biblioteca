<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gráfico de Gênero de Livros Mais Alugados por Sala</title>
    <!-- Incluir Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Estilos para o gráfico */
        canvas {
            display: block;
            margin: auto;
            max-width: 800px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div style="width: 80%; margin: auto;">
        <h1>Gráfico de Gênero de Livros Mais Alugados por Sala</h1>
        <canvas id="grafico"></canvas>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const livros = [
                { id: 1, titulo: 'Dom Casmurro', genero: 'Romance', quantidade: 3, disponivel: true },
                { id: 2, titulo: 'Memórias Póstumas de Brás Cubas', genero: 'Romance', quantidade: 2, disponivel: true },
                { id: 3, titulo: 'O Cortiço', genero: 'Romance', quantidade: 1, disponivel: false },
                { id: 4, titulo: 'Vidas Secas', genero: 'Romance', quantidade: 4, disponivel: true },
                { id: 5, titulo: 'Grande Sertão: Veredas', genero: 'Romance', quantidade: 2, disponivel: true }
            ];

            let alugueis = [
                { livro: 'Dom Casmurro', nome: 'João', sala: 'Sala 1' },
                { livro: 'Memórias Póstumas de Brás Cubas', nome: 'Maria', sala: 'Sala 2' },
                { livro: 'Dom Casmurro', nome: 'José', sala: 'Sala 1' },
                { livro: 'Vidas Secas', nome: 'Ana', sala: 'Sala 3' },
                { livro: 'Grande Sertão: Veredas', nome: 'Pedro', sala: 'Sala 2' }
            ];

            // Função para atualizar o gráfico
            function atualizarGrafico() {
                const dadosPorSala = {};

                // Inicializa o objeto com contagem de gêneros por sala
                livros.forEach(livro => {
                    if (!dadosPorSala[livro.sala]) {
                        dadosPorSala[livro.sala] = {};
                    }
                    if (!dadosPorSala[livro.sala][livro.genero]) {
                        dadosPorSala[livro.sala][livro.genero] = 0;
                    }
                });

                // Conta a quantidade de livros por gênero em cada sala
                alugueis.forEach(aluguel => {
                    if (dadosPorSala[aluguel.sala] && livros.find(livro => livro.titulo === aluguel.livro)) {
                        const genero = livros.find(livro => livro.titulo === aluguel.livro).genero;
                        dadosPorSala[aluguel.sala][genero] += 1;
                    }
                });

                // Prepara os dados para o gráfico
                const labels = Object.keys(dadosPorSala); // Salas
                const generos = Object.keys(livros.reduce((acc, livro) => {
                    acc[livro.genero] = true;
                    return acc;
                }, {})); // Todos os gêneros

                const datasets = generos.map(genero => ({
                    label: genero,
                    data: labels.map(sala => dadosPorSala[sala][genero] || 0),
                    backgroundColor: randomColor(), // Função para gerar cores aleatórias (opcional)
                }));

                // Atualiza o gráfico
                if (window.grafico) {
                    grafico.data.labels = labels;
                    grafico.data.datasets = datasets;
                    grafico.update();
                } else {
                    const ctx = document.getElementById('grafico').getContext('2d');
                    window.grafico = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: datasets
                        },
                        options: {
                            responsive: true,
                            scales: {
                                xAxes: [{ stacked: true }],
                                yAxes: [{ stacked: true }]
                            }
                        }
                    });
                }
            }

            // Atualiza o gráfico inicialmente
            atualizarGrafico();

            // Função para gerar cores aleatórias (opcional)
            function randomColor() {
                const r = Math.floor(Math.random() * 255);
                const g = Math.floor(Math.random() * 255);
                const b = Math.floor(Math.random() * 255);
                return `rgba(${r},${g},${b},0.6)`;
            }

            // Função para atualizar o gráfico periodicamente (por exemplo, a cada 10 segundos)
            setInterval(atualizarGrafico, 10000); // Atualiza a cada 10 segundos (10000 milissegundos)
        });
    </script>
</body>
</html>
